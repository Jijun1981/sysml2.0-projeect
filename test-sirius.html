<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Sirius Web调试页面</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Sirius Web 系统检查</h1>
    
    <div class="status">
        <h3>前端状态 (端口5173)</h3>
        <div id="frontend-status">检查中...</div>
    </div>
    
    <div class="status">
        <h3>后端状态 (端口8080)</h3>
        <div id="backend-status">检查中...</div>
    </div>
    
    <div class="status">
        <h3>GraphQL API测试</h3>
        <button onclick="testGraphQL()">测试GraphQL</button>
        <pre id="graphql-result"></pre>
    </div>
    
    <div class="status">
        <h3>直接访问链接</h3>
        <p><a href="http://localhost:5173" target="_blank">打开Sirius Web前端 (开发模式)</a></p>
        <p><a href="http://localhost:8080" target="_blank">打开后端首页</a></p>
        <p><a href="http://localhost:8080/api/graphql" target="_blank">GraphQL Playground</a></p>
    </div>
    
    <div class="status">
        <h3>React渲染诊断</h3>
        <iframe id="sirius-frame" src="http://localhost:5173" style="width: 100%; height: 400px; border: 1px solid #ccc;"></iframe>
    </div>

    <script>
        // 检查前端
        fetch('http://localhost:5173')
            .then(res => {
                if (res.ok) {
                    document.getElementById('frontend-status').innerHTML = '<span class="success">✓ 运行中</span>';
                } else {
                    document.getElementById('frontend-status').innerHTML = '<span class="error">✗ 错误: ' + res.status + '</span>';
                }
            })
            .catch(err => {
                document.getElementById('frontend-status').innerHTML = '<span class="error">✗ 无法连接</span>';
            });
        
        // 检查后端
        fetch('http://localhost:8080/api/graphql', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: '{ __schema { queryType { name } } }' })
        })
            .then(res => res.json())
            .then(data => {
                if (data.data) {
                    document.getElementById('backend-status').innerHTML = '<span class="success">✓ GraphQL API运行中</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = '<span class="error">✗ GraphQL错误</span>';
                }
            })
            .catch(err => {
                document.getElementById('backend-status').innerHTML = '<span class="error">✗ 无法连接</span>';
            });
        
        function testGraphQL() {
            const query = `{
                viewer {
                    projects {
                        edges {
                            node {
                                id
                                name
                            }
                        }
                    }
                }
            }`;
            
            fetch('http://localhost:8080/api/graphql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            })
                .then(res => res.json())
                .then(data => {
                    document.getElementById('graphql-result').textContent = JSON.stringify(data, null, 2);
                })
                .catch(err => {
                    document.getElementById('graphql-result').textContent = '错误: ' + err;
                });
        }
        
        // 尝试注入React调试
        setTimeout(() => {
            try {
                const frame = document.getElementById('sirius-frame');
                console.log('Frame loaded:', frame);
                // 由于跨域限制，无法直接访问iframe内容
            } catch(e) {
                console.log('跨域限制:', e);
            }
        }, 3000);
    </script>
</body>
</html>