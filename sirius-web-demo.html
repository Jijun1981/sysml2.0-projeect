<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Sirius Web - CDOé›†æˆæ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: #1e3a8a;
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        .header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .sidebar {
            width: 300px;
            background: #f7f7f7;
            border-right: 1px solid #ddd;
            padding: 1rem;
            overflow-y: auto;
        }
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .toolbar {
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 0.5rem 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .canvas {
            flex: 1;
            background: #fafafa;
            position: relative;
            overflow: hidden;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .button:hover {
            background: #45a049;
        }
        .button.secondary {
            background: #2196F3;
        }
        .button.secondary:hover {
            background: #1976D2;
        }
        .status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status.connected {
            border-left: 4px solid #4CAF50;
        }
        .status.disconnected {
            border-left: 4px solid #f44336;
        }
        .tree-item {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            margin: 2px 0;
        }
        .tree-item:hover {
            background: #e0e0e0;
        }
        .tree-item.selected {
            background: #1e3a8a;
            color: white;
        }
        .model-element {
            position: absolute;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
            cursor: move;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .model-element.requirement {
            border-color: #FF9800;
        }
        .model-element.part {
            border-color: #2196F3;
        }
        .model-element.port {
            border-color: #9C27B0;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .properties-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 300px;
            display: none;
        }
        .properties-panel.show {
            display: block;
        }
        .property-row {
            margin: 10px 0;
        }
        .property-row label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
        }
        .property-row input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš€ Sirius Web - SysML v2å»ºæ¨¡å¹³å°</h1>
        <p>åŸºäºCDOçš„åˆ†å¸ƒå¼æ¨¡å‹å­˜å‚¨ | KerML/SysML M2å…ƒæ¨¡å‹ | å®æ—¶åä½œ</p>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <h3>æ¨¡å‹æµè§ˆå™¨</h3>
            <div id="modelTree">
                <div class="tree-item">ğŸ“¦ SysML Project</div>
                <div style="margin-left: 20px">
                    <div class="tree-item">ğŸ“‹ Requirements</div>
                    <div class="tree-item">ğŸ”§ Structure</div>
                    <div class="tree-item">âš¡ Behavior</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px">å…ƒç´ åº“</h3>
            <button class="button" onclick="createElement('requirement')">+ éœ€æ±‚</button>
            <button class="button secondary" onclick="createElement('part')">+ éƒ¨ä»¶</button>
            <button class="button" style="background: #9C27B0" onclick="createElement('port')">+ ç«¯å£</button>
        </div>
        
        <div class="main">
            <div class="toolbar">
                <button class="button" onclick="saveToCDO()">ğŸ’¾ ä¿å­˜åˆ°CDO</button>
                <button class="button secondary" onclick="loadFromCDO()">ğŸ“‚ ä»CDOåŠ è½½</button>
                <button class="button" onclick="checkHealth()">ğŸ¥ å¥åº·æ£€æŸ¥</button>
                <button class="button secondary" onclick="connectToM2()">ğŸ”— è¿æ¥M2æ¨¡å‹</button>
            </div>
            
            <div class="canvas" id="canvas">
                <div class="status connected" id="status">
                    <strong>CDOçŠ¶æ€:</strong> <span id="cdoStatus">å·²è¿æ¥</span><br>
                    <strong>Repository:</strong> sysml<br>
                    <strong>Session:</strong> tcp://localhost:2036
                </div>
                
                <div class="properties-panel" id="propertiesPanel">
                    <h3>å±æ€§ç¼–è¾‘å™¨</h3>
                    <div class="property-row">
                        <label>åç§°:</label>
                        <input type="text" id="propName" onchange="updateProperty('name')">
                    </div>
                    <div class="property-row">
                        <label>ç±»å‹:</label>
                        <input type="text" id="propType" readonly>
                    </div>
                    <div class="property-row">
                        <label>CDO ID:</label>
                        <input type="text" id="propCdoId" readonly>
                    </div>
                    <button class="button" onclick="saveProperties()">ä¿å­˜å±æ€§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let elementCount = 0;
        let selectedElement = null;
        let cdoConnected = true;
        
        // æ¨¡æ‹ŸCDOåç«¯API
        const CDO_API = 'http://localhost:8080';
        
        function createElement(type) {
            elementCount++;
            const element = document.createElement('div');
            element.className = `model-element ${type}`;
            element.id = `element-${elementCount}`;
            element.innerHTML = `${type.charAt(0).toUpperCase() + type.slice(1)}_${elementCount}`;
            element.style.left = `${50 + Math.random() * 400}px`;
            element.style.top = `${50 + Math.random() * 300}px`;
            
            // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            element.onmousedown = function(e) {
                selectedElement = element;
                showProperties(element);
                
                const startX = e.clientX - element.offsetLeft;
                const startY = e.clientY - element.offsetTop;
                
                function moveElement(e) {
                    element.style.left = (e.clientX - startX) + 'px';
                    element.style.top = (e.clientY - startY) + 'px';
                }
                
                function stopMove() {
                    document.removeEventListener('mousemove', moveElement);
                    document.removeEventListener('mouseup', stopMove);
                }
                
                document.addEventListener('mousemove', moveElement);
                document.addEventListener('mouseup', stopMove);
            };
            
            document.getElementById('canvas').appendChild(element);
            
            // æ¨¡æ‹Ÿè°ƒç”¨M2å…ƒæ¨¡å‹åˆ›å»º
            console.log(`é€šè¿‡M2åˆ›å»º${type}å…ƒç´ :`, {
                metaclass: type,
                name: element.innerHTML,
                cdoId: `OID${elementCount}`
            });
        }
        
        function showProperties(element) {
            const panel = document.getElementById('propertiesPanel');
            panel.classList.add('show');
            
            document.getElementById('propName').value = element.innerHTML;
            document.getElementById('propType').value = element.className.split(' ')[1];
            document.getElementById('propCdoId').value = `OID${element.id.split('-')[1]}`;
        }
        
        function saveProperties() {
            if (selectedElement) {
                selectedElement.innerHTML = document.getElementById('propName').value;
                alert('å±æ€§å·²ä¿å­˜');
            }
        }
        
        async function saveToCDO() {
            const elements = document.querySelectorAll('.model-element');
            const modelData = Array.from(elements).map(el => ({
                id: el.id,
                type: el.className.split(' ')[1],
                name: el.innerHTML,
                position: {
                    x: parseInt(el.style.left),
                    y: parseInt(el.style.top)
                }
            }));
            
            try {
                // æ¨¡æ‹Ÿä¿å­˜åˆ°CDO
                console.log('ä¿å­˜æ¨¡å‹åˆ°CDO:', modelData);
                alert(`æˆåŠŸä¿å­˜ ${modelData.length} ä¸ªå…ƒç´ åˆ°CDO Repository`);
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }
        
        async function loadFromCDO() {
            try {
                // æ¨¡æ‹Ÿä»CDOåŠ è½½
                alert('ä»CDO RepositoryåŠ è½½æ¨¡å‹...');
                console.log('è¿æ¥åˆ°CDO: tcp://localhost:2036/sysml');
            } catch (error) {
                alert('åŠ è½½å¤±è´¥: ' + error.message);
            }
        }
        
        async function checkHealth() {
            try {
                const response = await fetch(`${CDO_API}/health`);
                const data = await response.json();
                
                if (data.cdo && data.cdo.repositoryState === 'ONLINE') {
                    alert('âœ… ç³»ç»Ÿå¥åº·çŠ¶æ€æ­£å¸¸\n\nCDO: ONLINE\nEMF: å·²åŠ è½½\nKerML/SysML: å·²æ³¨å†Œ');
                } else {
                    alert('âš ï¸ CDOçŠ¶æ€å¼‚å¸¸');
                }
            } catch (error) {
                alert('æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡\nè¯·ç¡®ä¿CDOæœåŠ¡è¿è¡Œåœ¨ localhost:8080');
            }
        }
        
        function connectToM2() {
            alert('å·²è¿æ¥åˆ°M2å…ƒæ¨¡å‹:\n- KerML: 84ä¸ªå…ƒç±»\n- SysML: Requirements, Parts, Portsç­‰');
            console.log('M2å…ƒæ¨¡å‹å·²åŠ è½½:', {
                kerml: 'https://www.omg.org/spec/KerML/20250201',
                sysml: 'http://www.omg.org/spec/SysML/20230201'
            });
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Sirius Webåˆå§‹åŒ–å®Œæˆ');
            console.log('CDOè¿æ¥çŠ¶æ€:', cdoConnected ? 'ONLINE' : 'OFFLINE');
        });
    </script>
</body>
</html>