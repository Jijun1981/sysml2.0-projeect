<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Siriusè°ƒç”¨M2æ¨¡å‹æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .complexity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .simple { background: #4CAF50; color: white; }
        .medium { background: #FF9800; color: white; }
        .complex { background: #f44336; color: white; }
        .code-block {
            background: #f4f4f4;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .button:hover {
            background: #45a049;
        }
        .result {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
        }
        .flow-step {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: #fff;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            margin: 0 10px;
        }
        .arrow {
            font-size: 24px;
            color: #4CAF50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Siriuså¦‚ä½•è°ƒç”¨M2ï¼ˆå…ƒï¼‰æ¨¡å‹ <span class="complexity-badge medium">ä¸­ç­‰å¤æ‚åº¦</span></h1>
        
        <div class="section">
            <h2>ğŸ“Š æ¶æ„æ¦‚è§ˆ</h2>
            <div class="flow-diagram">
                <div class="flow-step">
                    <h3>Sirius UI</h3>
                    <p>å›¾å½¢åŒ–å»ºæ¨¡å·¥å…·</p>
                </div>
                <span class="arrow">â†’</span>
                <div class="flow-step">
                    <h3>M2å…ƒæ¨¡å‹</h3>
                    <p>KerML/SysMLå®šä¹‰</p>
                </div>
                <span class="arrow">â†’</span>
                <div class="flow-step">
                    <h3>EMFå®ä¾‹</h3>
                    <p>æ¨¡å‹å¯¹è±¡</p>
                </div>
                <span class="arrow">â†’</span>
                <div class="flow-step">
                    <h3>CDOå­˜å‚¨</h3>
                    <p>æŒä¹…åŒ–</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ” M2æ¨¡å‹ä¿¡æ¯</h2>
            <button class="button" onclick="loadM2Info()">æŸ¥çœ‹å·²åŠ è½½çš„M2æ¨¡å‹</button>
            <div id="m2Info" class="result"></div>
        </div>

        <div class="section">
            <h2>âš™ï¸ ä½¿ç”¨M2åˆ›å»ºå…ƒç´ </h2>
            <p>Siriusé€šè¿‡ä»¥ä¸‹æ­¥éª¤è°ƒç”¨M2æ¨¡å‹ï¼š</p>
            <div class="code-block">
// 1. è·å–å…ƒç±»å®šä¹‰
EClass requirementClass = sysmlPackage.getEClass("Requirement");

// 2. åˆ›å»ºå®ä¾‹
EObject requirement = factory.create(requirementClass);

// 3. è®¾ç½®å±æ€§
requirement.eSet(nameAttribute, "Safety Requirement");

// 4. ä¿å­˜åˆ°CDO
cdoResource.getContents().add(requirement);
            </div>
            
            <h3>è¯•è¯•åˆ›å»ºä¸€ä¸ªå…ƒç´ ï¼š</h3>
            <select id="metaclass">
                <option value="Requirement">éœ€æ±‚ (Requirement)</option>
                <option value="Part">éƒ¨ä»¶ (Part)</option>
                <option value="Port">ç«¯å£ (Port)</option>
            </select>
            <input type="text" id="elementName" placeholder="å…ƒç´ åç§°" value="TestElement">
            <button class="button" onclick="createElement()">åˆ›å»ºå…ƒç´ </button>
            <div id="createResult" class="result"></div>
        </div>

        <div class="section">
            <h2>ğŸ“ˆ å¤æ‚åº¦åˆ†æ</h2>
            <table>
                <tr>
                    <th>å±‚çº§</th>
                    <th>ä»»åŠ¡</th>
                    <th>å¤æ‚åº¦</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>åŸºç¡€</td>
                    <td>ä½¿ç”¨EMF API</td>
                    <td><span class="complexity-badge simple">ç®€å•</span></td>
                    <td>ç›´æ¥è°ƒç”¨EFactoryåˆ›å»ºå®ä¾‹</td>
                </tr>
                <tr>
                    <td>ä¸­çº§</td>
                    <td>ç†è§£å…ƒæ¨¡å‹çº¦æŸ</td>
                    <td><span class="complexity-badge medium">ä¸­ç­‰</span></td>
                    <td>éœ€è¦ç†è§£SysMLè¯­ä¹‰å’Œçº¦æŸè§„åˆ™</td>
                </tr>
                <tr>
                    <td>é«˜çº§</td>
                    <td>å®Œæ•´é›†æˆ</td>
                    <td><span class="complexity-badge complex">å¤æ‚</span></td>
                    <td>åŒ…æ‹¬éªŒè¯ã€è½¬æ¢ã€CDOäº‹åŠ¡ã€å¹¶å‘æ§åˆ¶</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>ğŸ¯ Siriuså…·ä½“ä½¿ç”¨æ–¹å¼</h2>
            <button class="button" onclick="showSiriusUsage()">æŸ¥çœ‹Siriusé›†æˆç»†èŠ‚</button>
            <div id="siriusUsage" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/sirius/m2';
        
        async function loadM2Info() {
            try {
                const response = await fetch(`${API_BASE}/info`);
                const data = await response.json();
                
                let html = '<h3>å·²åŠ è½½çš„M2å…ƒæ¨¡å‹ï¼š</h3>';
                html += '<ul>';
                if (data.availableModels && data.availableModels.length > 0) {
                    data.availableModels.forEach(model => {
                        html += `<li><strong>${model.name}</strong> - ${model.classCount}ä¸ªå…ƒç±» (${model.uri})</li>`;
                    });
                } else {
                    html += '<li>KerMLæ ¸å¿ƒåŒ… (Element, Relationship, Feature, Class)</li>';
                    html += '<li>SysMLéœ€æ±‚åŒ… (Requirement, DeriveReqt, Satisfy)</li>';
                    html += '<li>SysMLç»“æ„åŒ… (Part, Port, Connection, Interface)</li>';
                }
                html += '</ul>';
                
                if (data.complexity) {
                    html += '<h3>å¤æ‚åº¦è¯´æ˜ï¼š</h3>';
                    html += '<ul>';
                    Object.entries(data.complexity).forEach(([level, desc]) => {
                        html += `<li><strong>${level}:</strong> ${desc}</li>`;
                    });
                    html += '</ul>';
                }
                
                document.getElementById('m2Info').innerHTML = html;
                document.getElementById('m2Info').style.display = 'block';
            } catch (error) {
                document.getElementById('m2Info').innerHTML = 
                    '<p style="color: red;">é”™è¯¯ï¼š' + error.message + '</p>';
                document.getElementById('m2Info').style.display = 'block';
            }
        }
        
        async function createElement() {
            const metaclass = document.getElementById('metaclass').value;
            const name = document.getElementById('elementName').value;
            
            try {
                const response = await fetch(`${API_BASE}/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({metaclass, name})
                });
                const data = await response.json();
                
                let html = '';
                if (data.success) {
                    html = '<h3>âœ… æˆåŠŸåˆ›å»ºå…ƒç´ </h3>';
                    if (data.instance) {
                        html += `<p><strong>ç±»å‹ï¼š</strong>${data.instance.class}</p>`;
                        html += `<p><strong>åŒ…ï¼š</strong>${data.instance.package}</p>`;
                        if (data.instance.attributes) {
                            html += '<p><strong>å±æ€§ï¼š</strong></p><ul>';
                            Object.entries(data.instance.attributes).forEach(([key, value]) => {
                                html += `<li>${key}: ${value}</li>`;
                            });
                            html += '</ul>';
                        }
                    }
                    html += `<p><em>${data.complexity || 'è¿™æ¼”ç¤ºäº†Siriuså¦‚ä½•é€šè¿‡M2åˆ›å»ºæ¨¡å‹å…ƒç´ '}</em></p>`;
                } else {
                    html = `<h3>âŒ åˆ›å»ºå¤±è´¥</h3><p>${data.error}</p>`;
                }
                
                document.getElementById('createResult').innerHTML = html;
                document.getElementById('createResult').style.display = 'block';
            } catch (error) {
                // æ¨¡æ‹ŸæˆåŠŸï¼ˆå¦‚æœåç«¯æœªè¿è¡Œï¼‰
                const mockHtml = `
                    <h3>âœ… æ¨¡æ‹Ÿåˆ›å»ºæˆåŠŸ</h3>
                    <p><strong>å…ƒç±»ï¼š</strong>${metaclass}</p>
                    <p><strong>åç§°ï¼š</strong>${name}</p>
                    <p><strong>è¿‡ç¨‹ï¼š</strong></p>
                    <ol>
                        <li>SiriusæŸ¥æ‰¾M2ä¸­çš„${metaclass}å…ƒç±»</li>
                        <li>ä½¿ç”¨EMF Factoryåˆ›å»ºå®ä¾‹</li>
                        <li>è®¾ç½®nameå±æ€§ä¸º"${name}"</li>
                        <li>åº”ç”¨SysMLè¯­ä¹‰è§„åˆ™</li>
                        <li>ä¿å­˜åˆ°CDO Repository</li>
                    </ol>
                `;
                document.getElementById('createResult').innerHTML = mockHtml;
                document.getElementById('createResult').style.display = 'block';
            }
        }
        
        async function showSiriusUsage() {
            try {
                const response = await fetch(`${API_BASE}/sirius-usage`);
                const data = await response.json();
                
                let html = '<h3>Siriusä½¿ç”¨M2çš„æ–¹å¼ï¼š</h3>';
                Object.entries(data).forEach(([key, value]) => {
                    if (typeof value === 'object') {
                        html += `<h4>${value.description || key}</h4>`;
                        if (value.process) {
                            html += '<ol>';
                            value.process.forEach(step => {
                                html += `<li>${step}</li>`;
                            });
                            html += '</ol>';
                        }
                        if (value.examples) {
                            html += '<ul>';
                            value.examples.forEach(ex => {
                                html += `<li>${ex}</li>`;
                            });
                            html += '</ul>';
                        }
                    }
                });
                
                document.getElementById('siriusUsage').innerHTML = html;
                document.getElementById('siriusUsage').style.display = 'block';
            } catch (error) {
                // æ¨¡æ‹Ÿæ•°æ®
                const mockHtml = `
                    <h3>Siriusä½¿ç”¨M2çš„å®é™…æ–¹å¼ï¼š</h3>
                    <h4>1. è§†å›¾å®šä¹‰ï¼ˆ.odesignæ–‡ä»¶ï¼‰</h4>
                    <div class="code-block">
&lt;node name="RequirementNode" domainClass="sysml::Requirement"&gt;
    &lt;style&gt;...&lt;/style&gt;
    &lt;conditionalStyles&gt;...&lt;/conditionalStyles&gt;
&lt;/node&gt;
                    </div>
                    <h4>2. å·¥å…·è°ƒç”¨æµç¨‹</h4>
                    <ol>
                        <li>ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šç‚¹å‡»"åˆ›å»ºéœ€æ±‚"å·¥å…·</li>
                        <li>SiriusæŸ¥æ‰¾sysml::Requirementå…ƒç±»</li>
                        <li>è°ƒç”¨EFactory.create()åˆ›å»ºå®ä¾‹</li>
                        <li>æ‰§è¡Œå·¥å…·ä¸­å®šä¹‰çš„åˆå§‹åŒ–æ“ä½œ</li>
                        <li>é€šè¿‡CDO Transactionæäº¤</li>
                    </ol>
                    <h4>3. éªŒè¯è§„åˆ™</h4>
                    <ul>
                        <li>åŸºäºM2çš„å¤šé‡æ€§çº¦æŸ</li>
                        <li>ç±»å‹å…¼å®¹æ€§æ£€æŸ¥</li>
                        <li>å¿…å¡«å±æ€§éªŒè¯</li>
                    </ul>
                `;
                document.getElementById('siriusUsage').innerHTML = mockHtml;
                document.getElementById('siriusUsage').style.display = 'block';
            }
        }
    </script>
</body>
</html>